<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basemap Toggle Map - Standalone</title>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            font-weight: 400;
            color-scheme: light dark;
            color: rgba(255, 255, 255, 0.87);
            background-color: #242424;
            font-synthesis: none;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            height: 100vh;
            overflow: hidden;
        }

        #map {
            width: 100vw;
            height: 100vh;
        }

        /* Mapbox control styling */
        .mapboxgl-ctrl {
            font-size: 14px;
        }

        .mapboxgl-ctrl-group {
            background-color: #666 !important;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .mapboxgl-ctrl-group select {
            padding: 5px;
            border: none;
            background: transparent;
            color: white;
            font-size: 14px;
        }

        .mapboxgl-ctrl-group option {
            color: black;
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .mapboxgl-ctrl {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script>
        // Replace with your actual Mapbox access token
        mapboxgl.accessToken = 'pk.eyJ1IjoiZ2Vvc3R1ZGlvIiwiYSI6ImNrNWk5Mmp5eDBjNHQzbW10M3d6NzI1Y28ifQ.MPmtingHT1zi_Wk5ZxW8wA';

        // Define map style
        const lightStyle = 'mapbox://styles/geostudio/cmfl3fgpy001j01s82205hrxq';
        const darkStyle = 'mapbox://styles/geostudio/cmfl6xt04003a01rxccb4hs82';

        // Initialize map
        const map = new mapboxgl.Map({
            container: 'map',
            style: lightStyle,
            //center: [-74.5, 40], // uncomment and change to your desired initial center. Default mapsyle
            //zoom: 9 // uncomment and change to your desired initial zoom level. Default mapsyle
        });

        // Store original light style
        let originalLightStyle = null;
        const darkStyleUrl = darkStyle;

        // Initially hide satellite and background layers when map loads
        map.on('load', () => {
            // Store the original light style
            originalLightStyle = map.getStyle();
            console.log('Original light style stored');
            
            // Hide satellite layer if it exists
            if (map.getLayer('satellite')) {
                map.setLayoutProperty('satellite', 'visibility', 'none');
            }
            // Hide background layer if it exists
            if (map.getLayer('background')) {
                map.setLayoutProperty('background', 'visibility', 'none');
            }
        });

        // Add navigation control (zoom in/out) to the top-right
        map.addControl(new mapboxgl.NavigationControl(), 'top-right');

        // Add geolocate control to the top-right
        map.addControl(new mapboxgl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true,
            showUserHeading: true
        }), 'top-right');

        // Custom control for basemap toggle
        class BasemapToggleControl {
            onAdd(map) {
                this._map = map;
                this._container = document.createElement('div');
                this._container.className = 'mapboxgl-ctrl mapboxgl-ctrl-group';
                this._container.style.backgroundColor = '#666';
                this._container.style.borderRadius = '4px';
                this._container.style.boxShadow = '0 0 10px rgba(0,0,0,0.1)';

                const select = document.createElement('select');
                select.style.padding = '5px';
                select.style.border = 'none';
                select.style.background = 'transparent';
                select.style.fontSize = '14px';
                select.style.color = 'white';

                const lightOption = document.createElement('option');
                lightOption.value = 'light';
                lightOption.text = 'Light';
                lightOption.style.color = 'black';
                select.appendChild(lightOption);

                const darkOption = document.createElement('option');
                darkOption.value = 'dark';
                darkOption.text = 'Dark';
                darkOption.style.color = 'black';
                select.appendChild(darkOption);

                select.addEventListener('change', (e) => {
                    const mode = e.target.value;
                    if (mode === 'dark') {
                        console.log('Switching to dark mode...');
                        
                        // Fetch the dark style from Mapbox
                        fetch(`https://api.mapbox.com/styles/v1/${darkStyleUrl.replace('mapbox://styles/', '')}?access_token=${mapboxgl.accessToken}`)
                            .then(response => response.json())
                            .then(darkStyle => {
                                console.log('Dark style fetched successfully');
                                
                                // Apply the dark style to the map
                                map.setStyle(darkStyle);
                                
                                // After style is applied, ensure satellite and background layers are visible
                                map.once('style.load', () => {
                                    console.log('Dark style applied');
                                    if (map.getLayer('satellite')) {
                                        map.setLayoutProperty('satellite', 'visibility', 'visible');
                                    }
                                    if (map.getLayer('background')) {
                                        map.setLayoutProperty('background', 'visibility', 'visible');
                                    }
                                });
                            })
                            .catch(error => {
                                console.error('Error fetching dark style:', error);
                            });
                    } else {
                        console.log('Switching back to light mode...');
                        
                        // Restore the original light style
                        if (originalLightStyle) {
                            map.setStyle(originalLightStyle);
                            
                            // After style is applied, ensure satellite and background layers are hidden
                            map.once('style.load', () => {
                                console.log('Light style restored');
                                if (map.getLayer('satellite')) {
                                    map.setLayoutProperty('satellite', 'visibility', 'none');
                                }
                                if (map.getLayer('background')) {
                                    map.setLayoutProperty('background', 'visibility', 'none');
                                }
                            });
                        } else {
                            console.error('Original light style not found');
                        }
                    }
                });

                this._container.appendChild(select);
                return this._container;
            }

            onRemove() {
                this._container.parentNode.removeChild(this._container);
                this._map = undefined;
            }
        }

        // Add basemap toggle control to the top-left
        map.addControl(new BasemapToggleControl(), 'top-left');
    </script>
</body>
</html>
